---
- summary: |
    Проверка успешной регистрации нового пользователя
  requirement: |
    При вводе валидной почты, никнейма и пароля пользователь должен зарегистрироваться в системе
  prerequisites: |
    Нет
  test-data: |
    - Nickname = testuser2 
    - email = testuser@example.com 
    - password = admin123.
  steps:
    * Открыть страницу регистрации
    * Ввести "testuser2" в поле Nickname
    * Ввести "testuser@example.com" в поле Email
    * Ввести "admin123." в поле Password
    * Повторно ввести "admin123." в поле Password confirmation
    * Нажать кнопку Submit
  expected-result: |
    - Пользователь зарегистрирован и перенаправлен на главную страницу сайта
    - В базе данных появляется новая запись с указанной почтой и никнеймом

- summary: |
    Проверка неуспешной регистрации с некорректным email
  requirement: |
    При вводе некорректной почты пользователь не должен зарегистрироваться
  prerequisites:
    Нет
  test-data: |
    - Nickname = testuser3 
    - email = testuser@example 
    - password = admin123.
  steps:
    1. Открыть страницу регистрации
    2. Ввести "testuser3" в поле Nickname
    3. Ввести "testuser@example" в поле Email
    4. Ввести "admin123." в поле Password
    5. Повторно ввести "admin123." в поле Password confirmation
    6. Нажать кнопку Submit
  expected-result: |
    - Регистрация не проходит
    - Появляется сообщение "Invalid email"
    - Пользователь не добавляется в базу данных

- summary: |
    Проверка успешного входа через OAuth-интеграцию с Github
  requirement: |
    Пользователь с аккаунтом GitHub должен иметь возможность войти в систему через OAuth без ввода логина и пароля на Codebattle
  prerequisites:
    GitHub-аккаунт пользователя существует и не привязан к другому профилю Codebattle
  test-data: |
    Нет
  steps:
    1. Нажать на кнопку "Sign up with Github"
    2. Убедиться, что происходит перенаправление на страницу авторизации GitHub
    3. Ввести валидный логин и пароль от Github
    4. Подтвердить разрешения для Codebattle
  expected-result: |
    - Пользователь успешно авторизован в Codebattle
    - Происходит перенаправление на главную страницу
    - В профиле пользователя отображается привязанный GitHub-аккаунт

- summary: |
    Проверка успешного входа через OAuth-интеграцию с Discord
  requirement: |
    Пользователь с аккаунтом Discord должен иметь возможность войти в систему через OAuth без ввода логина и пароля на Codebattle
  prerequisites:
    Discord-аккаунт пользователя существует и не привязан к другому профилю Codebattle
  test-data: |
    Нет
  steps:
    1. Нажать на кнопку "Sign up with Discord"
    2. Убедиться, что происходит перенаправление на страницу авторизации Discord
    3. Ввести валидный логин и пароль от Discord
    4. Подтвердить разрешения для Codebattle
  expected-result: |
    - Пользователь успешно авторизован в Codebattle
    - Происходит перенаправление на главную страницу
    - В профиле пользователя отображается привязанный Discord-аккаунт

- summary: |
    Проверка успешной авторизации через email и пароль
  requirement: |
    При вводе валидных данных в форме входа пользователь должен войти в свой аккаунт
  prerequisites:
    Нет
  test-data: |
    - Email = testuser@example.com
    - Password = admin123.
  steps:
    1. Перейти на страницу входа
    2. Ввести в поле email "testuser@example.com"
    3. Ввести в поле пароль "admin123."
    4. Нажать кнопку Submit
  expected-result: |
    - Пользователь авторизован 
    - Происходит редирект на главную страницу
    - В cookie-файлах появляется параметр sessionId

- summary: |
    Проверка успешной отправки письма для смены пароля через email
  requirement: |
    Пользователь должен иметь возможность запросить смену пароля через свой email
  prerequisites:
    Пользователь не авторизован
  test-data: |
    Email = testuser@example.com
  steps:
    1. Перейти на страницу входа
    2. Нажать на кнопку "Forgot your password?"
    3. В поле Email ввести "testuser@example.com"
    4. Нажать кнопку "Submit"
  expected-result: |
    На почтовый адрес testuser@example.com отправлено письмо с инструкциями для смены пароля

- summary: |
    Проверка возможности участия в игре в гостевом режиме без авторизации
  requirement: |
    Система должна предоставлять возможность участия в пробном сражении без регистрации и авторизации
  prerequisites:
    Пользователь не авторизован
  test-data: |
    Нет
  steps:
    1. Нажать на кнопку "Try simple battle"
    2. Дождаться загрузки игровой сессии
    3. Ввести произвольный текст в поле для ввода кода
    4. Нажать кнопку "Run"
  expected-result: |
    - Пользователь перенаправлен на страницу с игрой 
    - Поле для ввода кода доступно для редактирования

- summary: |
    Проверка создания кастомной игры с пользовательскими настройками
  requirement: |
    Авторизованный пользователь должен иметь возможность создать игру с указанием уровня сложности, типа игры, контроля времени, конкретной задачи, тегов
  prerequisites:
    Нет
  test-data: |
    - Level = easy
    - Game type = With a bot
    - Time control = 8 min
    - Task = pizza_volume
    - Tags = math
  steps:
    1. Нажать на кнопку "Create a game"
    2. Выставить фильтры в соответствии с тестовыми данными
    3. Нажать кнопку "Create battle"
    4. Дождаться загрузки игровой сессии
  expected-result: |
    - Происходит редирект на страницу с новой игрой 
    - Настройки игры соответствуют указанным 
    - Противником выступает бот

- summary: |
    Проверка создания игры с приглашением друга
  requirement: |
    Система должна позволять создавать игру и отправлять уведомление приглашённому пользователю
  prerequisites:
    Пользователь 2 авторизован
  test-data: |
    - Level = elementary
    - Game type = With a friend
    - Time control = 8 min
    - Task = rect_area
    - Tags = math
  steps:
    1. Нажать на кнопку "Create a game"
    2. Выставить фильтры в соответствии с тестовыми данными
    3. Нажать кнопку "Create battle"
  expected-result: |
    - Пользователь 1 получает badge-уведомление (+1)
    - Уведомление отображает приглашение в игру

- summary: |
    Проверка принятия приглашения в игру и участие
  requirement: |
    Система должна обеспечивать совместный доступ к игровой сессии
  prerequisites:
    - Пользователь 1 авторизован через GitHub
    - Пользователь 2 отправил приглашение
  test-data: |
    Нет
  steps:
    1. Нажать на иконку уведомлений
    2. Выбрать приглашение от Пользователя 2
    3. Принять приглашение
    4. Дождаться загрузки игровой сессии
  expected-result: |
    - У обоих пользователей открыта одна игровая сессия (game session ID одинаковый)
    - Таймер показывает 8:00
    - Задача "rect_area"
    - Доступен чат
    - Уведомление помечается как прочитанное

- summary: |
    Проверка полного цикла успешного создания турнира и участия в нём
  requirement: |
    Система должна предоставлять возможность:
    - Создавать турниры с настройками по умолчанию
    - Присоединяться к созданному турниру
    - Запускать турнир после формирования лобби
    - Обеспечивать игровой процесс
  prerequisites:
    Нет
  test-data: |
    Настройки по умолчанию
  steps:
    1. Перейти во вкладку "Tournaments"
    2. Нажать на текстовую ссылку "You may want to create one"
    3. В блоке "Create a new tournament"
       - Убедиться, что сгенерировано название турнира
       - Оставить настройки по умолчанию
       - Нажать кнопку "Create"
    4. В лобби турнира
       - Нажать "Join" для участия
       - Дождаться возможности нажать "Start" и нажать на неё
       - Подтвердить запуск в диалоговом окне ("Confirm")
    5. В окне ожидания
       - Убедиться, что таймер обратного отсчёта работает корректно
       - Нажать "Open" или дождаться автоматического старта
    6. Убедиться, что загрузилась игровая сессия
  expected-result: |
    - Чат лобби доступен для сообщений
    - Таймер обратного отсчёта работает корректно
    - Открывается игровой интерфейс
    - Доступны все функциональные элементы (редактор кода, кнопка отправки решений)

- summary: |
    Проверка корректного отображения и обновления списка активных игр в лобби
  requirement: |
    Система должна отображать список всех доступных игр, обновлять информацию в реальном времени, сортировать игры по сложности (от легкой к сложной)
  prerequisites: |
    Нет
  test-data: |
    Нет
  steps:
    1. Убедиться, что список активных игр отображается (вкладка "Lobby")
    2. Проверить сортировку
       - Убедиться, что игры с уровнем сложности Easy отображаются выше Medium
       - Убедиться, что игры с уровнем сложности Medium отображаются выше Hard
    3. Проверить обновление в реальном времени
       - Запомнить количество игр и состояние одной из них
       - Подождать 30 секунд
       - Убедиться, что список обновился (изменилось количество игр или их состояние)
  expected-result: |
    - Все активные игры видны в лобби
    - Для каждой игры отображается уровень сложности, никнеймы участников, кнопки действий (присоединиться/показать), статус (ожидание/в процессе)
    - Игры упорядочены по сложности: Easy → Medium → Hard
    - Новые игры появляются автоматически
    - Изменения статусов отображаются без перезагрузки
    - Количество участников обновляется в реальном времени

- summary: |
    Проверка функционала наблюдения за активной игровой сессией других пользователей
  requirement: |
    Система должна предоставлять возможность:
    1. Просматривать активные игры других пользователей
    2. Отображать игровой процесс в реальном времени
    3. Обеспечивать функционал чата для наблюдателей
  prerequisites: |
    В списке активных игр есть минимум одна активная сессия
  test-data: |
    Нет
  steps:
    1. Найти игру со статусом "Playing" (в разделе "Lobby")
    2. Нажать кнопку "Show" в строке выбранной игры
    3. Убедиться, что страница полностью загрузилась
    4. Проверить элементы интерфейса
       - Во вкладке "General" нажать на поле для ввода текста
       - Ввести тестовое сообщение
       - Нажать на кнопку "Send"
  expected-result: |
    - Виден код обоих участников (read-only)
    - Отображается реальное состояние игры
    - Таймер обновляется в реальном времени
    - Видна текущая задача
    - Чат доступен для ввода сообщений

- summary: |
    Проверка возможности изменения и сохранения личной информации о пользователе
  requirement: |
    Пользователь должен иметь возможность менять и сохранять данные о себе в настройках
  prerequisites: |
    Нет
  test-data: |
    - Nickname = Lalala
    - Your weapon = Go
  steps:
    1. Нажать на свою аватарку
    2. Перейти в настройки через кнопку "Settings"
    3. Изменить данные согласно test-data
    4. Нажать кнопку "Save"
    5. Перезагрузить страницу
    6. Убедиться, что данные сохранены и отображаются корректно
  expected-result: |
    - Данные изменяются на указанные в test-data 
    - Данные сохраняются после перезагрузки страницы

- summary: |
    Проверка воспроизведения игры из истории в нормальном режиме
  requirement: |
    Пользователь должен иметь возможность просматривать полную историю прошедших игр
  prerequisites: |
    Нет
  test-data: |
    Нет
  steps:
    1. Перейти во вкладку "History"
    2. Выбрать любую игру и нажать кнопку "Show"
    3. Дождаться загрузки игры
    4. Нажать на кнопку "Play"
  expected-result: |
    Игра воспроизводится плавно, плеер не тормозит
